{% extends "base.html" %}
{% block title %}ุงูุญุฌุฒ{% endblock %}

{% block content %}
<section class="section">
  <div class="container">

    <h1 class="mt-0">ูููุฐุฌ ุงูุญุฌุฒ</h1>

    {# ุฑุณุงุฆู ููุงุด #}
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for cat, msg in messages %}
          <div class="alert {{ 'alert-success' if cat=='success' else 'alert-error' }}">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {# ูุงุฑุช ุชุฃููุฏ ุจุนุฏ ุงูุฅุฑุณุงู (ุนูุฏ submitted=True) #}
    {% if submitted and submit_payload %}
      <div class="form" style="border-style:dashed">
        <h2 class="mt-0">ุชู ุงุณุชูุงู ุทูุจู ๐</h2>
        <p class="mb-3">ุณูููู ุจุงูุชูุงุตู ูุนู ูุชุฃููุฏ ุงูุชูุงุตูู ูููุนุฏ ุงูุงูุทูุงู.</p>
        <div class="grid grid-2">
          <div>
            <p class="mb-2"><strong>ุงูุงุณู:</strong> {{ submit_payload.name }}</p>
            <p class="mb-2"><strong>ุงูุจุฑูุฏ:</strong> {{ submit_payload.email }}</p>
            <p class="mb-2"><strong>ุงูุฌูุงู:</strong> {{ submit_payload.phone }}</p>
          </div>
          <div>
            <p class="mb-2"><strong>ุงูุฑุญูุฉ:</strong> {{ submit_payload.trip.name }}</p>
            <p class="mb-2"><strong>ุนุฏุฏ ุงูุฃูุงู:</strong> {{ submit_payload.days }}</p>
            <p class="mb-2"><strong>ุงูุฅุฌูุงูู:</strong> {{ submit_payload.total }} {{ currency }}</p>
          </div>
        </div>
        <div class="mt-3">
          <a class="btn btn-ghost" href="{{ url_for('home') }}">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</a>
          <a class="btn btn-primary" href="{{ url_for('trips') }}">ุงุณุชุนุฑุงุถ ุฑุญูุงุช ุฃุฎุฑู</a>
        </div>
      </div>
    {% endif %}

    <form id="bookingForm" class="form mt-4" method="post" action="{{ url_for('book') }}">
      <div class="row">
        <div>
          <label class="label" for="name">ุงูุงุณู ุงููุงูู</label>
          <input id="name" class="input" type="text" name="name" placeholder="ุงูุงุณู" required>
        </div>
        <div>
          <label class="label" for="email">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
          <input id="email" class="input" type="email" name="email" placeholder="name@email.com" required>
        </div>
      </div>

      <div class="row">
        <div>
          <label class="label" for="phone">ุฑูู ุงูุฌูุงู</label>
          <input id="phone" class="input" type="tel" name="phone" inputmode="numeric"
                 pattern="05[0-9]{8}" placeholder="05xxxxxxxx" required>
          <div class="form-note">ุตูุบุฉ ุฑูู ุณุนูุฏู: ูุจุฏุฃ ุจู 05 ููุชููู ูู 10 ุฃุฑูุงู.</div>
        </div>
        <div>
          <label class="label" for="tripSelect">ุงุฎุชุฑ ุงูุฑุญูุฉ</label>
          <select id="tripSelect" class="input" name="trip_id" required>
            <option value="" disabled {% if not selected_trip_id %}selected{% endif %}>ุงุฎุชุฑ ุงูุฑุญูุฉ</option>
            {% for t in trips %}
              <option value="{{ t.id }}"
                      data-price="{{ t.price }}"
                      data-name="{{ t.name }}"
                      {% if selected_trip_id == t.id %}selected{% endif %}>
                {{ t.name }} โ {{ t.price }} {{ currency }} / ุงูููู
              </option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label class="label" for="startDate">ุชุงุฑูุฎ ุงูุจุฏุงูุฉ</label>
          <input id="startDate" class="input" type="date" name="start_date" min="{{ today }}" required>
        </div>
        <div>
          <label class="label" for="daysInput">ุนุฏุฏ ุงูุฃูุงู</label>
          <div style="display:flex; gap:8px; align-items:center;">
            <button class="btn btn-ghost" type="button" data-step="-1" aria-label="ููุต" style="width:44px;">โ</button>
            <input id="daysInput" class="input input--center" type="number" name="days" value="1" min="1" max="7" required style="max-width:120px">
            <button class="btn btn-ghost" type="button" data-step="1" aria-label="ุฒูุงุฏุฉ" style="width:44px;">+</button>
          </div>
          <div class="form-note">ุงูุญุฏ ุงูุฃุฏูู 1 ูุงูุญุฏ ุงูุฃูุตู 7 ุฃูุงู.</div>
        </div>
      </div>

      <div class="row">
        <div>
          <label class="label" for="pricePerDay">ุงูุณุนุฑ ููููู</label>
          <input id="pricePerDay" class="input" type="text" value="0 {{ currency }}" readonly>
        </div>
        <div>
          <label class="label" for="totalAmount">ุงูุฅุฌูุงูู ุงููุชููุน</label>
          <input id="totalAmount" class="input" type="text" value="0 {{ currency }}" readonly>
        </div>
      </div>

      <div class="form-check mt-3">
        <input id="agree" type="checkbox" required>
        <label for="agree" class="mb-0">ุฃูุงูู ุนูู <a href="{{ url_for('cancellation') }}" target="_blank">ุณูุงุณุฉ ุงูุฅูุบุงุก</a></label>
      </div>

      <div class="mt-3">
        <button id="submitBtn" class="btn btn-primary" type="submit" disabled>ุฅุฑุณุงู ุงูุญุฌุฒ</button>
      </div>
    </form>

  </div>
</section>
{% endblock %}
