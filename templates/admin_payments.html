{% extends "base.html" %}
{% block title %}ููุญุฉ ุงูุชุญูู โ ุงููุฏููุนุงุช{% endblock %}

{% block header %}
<header class="header small">
  <h1>๐ณ ุงููุฏููุนุงุช</h1>
  <p>ุณุฌู ุนูููุงุช ุงูุฏูุน ุนุจุฑ ุงูุจูุงุจุงุช</p>
</header>
{% endblock %}

{% block content %}
<section class="section">

  <div class="toolbar" style="display:flex;gap:10px;flex-wrap:wrap;align-items:end;margin-bottom:12px">
    <form method="get" action="{{ url_for('admin_payments') }}" class="form" style="display:flex;gap:8px;flex-wrap:wrap">
      <div>
        <label for="q">ุจุญุซ</label>
        <input id="q" name="q" value="{{ q or '' }}" placeholder="ุงููุนุงูุฌุฉ/ุงูุจูุงุจุฉ/ุงูุญุงูุฉ/ุฑูู ุงูุญุฌุฒ">
      </div>
      <button class="btn" type="submit" style="align-self:flex-end">ุจุญุซ</button>
      <a class="btn btn-outline" href="{{ url_for('admin_payments') }}" style="align-self:flex-end">ุฅุนุงุฏุฉ ุถุจุท</a>
    </form>
    <div style="margin-inline-start:auto">
      <a class="btn btn-outline" href="{{ url_for('admin_dashboard') }}">๐ ุงูุญุฌูุฒุงุช</a>
      <a class="btn btn-outline" href="{{ url_for('admin_reports') }}">๐ ุงูุชูุงุฑูุฑ</a>
      <a class="btn btn-outline" href="{{ url_for('admin_logout') }}">๐ช ุฎุฑูุฌ</a>
    </div>
  </div>

  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>#</th>
          <th>ุงูุญุฌุฒ</th>
          <th>ุงูุจูุงุจุฉ</th>
          <th>ุฑูู ุงูุนูููุฉ</th>
          <th>ุงูุญุงูุฉ</th>
          <th>ุงููุจูุบ</th>
          <th>ุงูุนููุฉ</th>
          <th>ุงูุชุงุฑูุฎ</th>
        </tr>
      </thead>
      <tbody>
        {% if payments %}
          {% for p in payments %}
          {# p = (id,booking_id,gateway,payment_id,status,amount,currency,created_at) #}
          <tr>
            <td>{{ p[0] }}</td>
            <td><a href="{{ url_for('admin_edit', bid=p[1]) }}" class="btn btn-mini">#{{ p[1] }}</a></td>
            <td>{{ p[2] }}</td>
            <td dir="ltr" style="max-width:280px;overflow:auto">{{ p[3] }}</td>
            <td>
              <span class="badge {{ 'paid' if (p[4] or '') == 'paid' else 'unpaid' }}">{{ p[4] }}</span>
            </td>
            <td>{{ (p[5] or 0) / 100 | round(2) }}</td>
            <td>{{ p[6] or 'SAR' }}</td>
            <td>{{ p[7] }}</td>
          </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="8" style="text-align:center">ูุง ุชูุฌุฏ ูุฏููุนุงุช ูุณุฌูุฉ ุญุงููุงู</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  {% if pages and pages > 1 %}
  <nav class="pagination" aria-label="ุชุฑููู ุงูุตูุญุงุช">
    <a class="page{{ ' disabled' if page<=1 }}" href="{{ url_for('admin_payments', q=q, page=page-1) }}">ุงูุณุงุจู</a>
    <span class="page-info">ุตูุญุฉ {{ page }} ูู {{ pages }}</span>
    <a class="page{{ ' disabled' if page>=pages }}" href="{{ url_for('admin_payments', q=q, page=page+1) }}">ุงูุชุงูู</a>
  </nav>
  {% endif %}
</section>
{% endblock %}
