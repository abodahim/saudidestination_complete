{% extends "base.html" %}
{% block title %}تم تأكيد الحجز — وجهة السعودية{% endblock %}
{% block content %}
<section class="container" style="padding:22px 0">
  <h1 class="page-title">تم تأكيد الحجز</h1>

  {% with msgs = get_flashed_messages(with_categories=true) %}
    {% if msgs %}
      <div class="flash">
        {% for cat, msg in msgs %}
          <p class="flash__msg {{cat}}">{{ msg }}</p>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  {% if paid %}
    <div class="card" style="padding:12px; margin:10px 0;">
      <p>✅ تم الدفع بنجاح — شكرًا لك!</p>
      <ul>
        <li>الرحلة: {{ details.trip_title or (data.trip.title if data and data.trip else 'رحلة') }}</li>
        <li>الاسم: {{ details.name or (data.name if data else '') }}</li>
        <li>البريد: {{ details.email or (data.email if data else '') }}</li>
        <li>التاريخ: {{ details.date or (data.date if data else '') }}</li>
        <li>الأيام: {{ details.days or (data.days if data else '') }} | الأشخاص: {{ details.persons or (data.persons if data else '') }}</li>
        <li>الإجمالي: {{ details.total_sar or (data.total_price if data else '') }} ر.س</li>
      </ul>

      <div class="note" style="margin-top:10px">
        ✅ يمكنك تحميل الفاتورة الآن، وظهرت بيانات التواصل.
      </div>
      <div class="card__actions" style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;">
        <a class="btn btn--primary" href="{{ url_for('invoice_pdf') }}">تحميل الفاتورة PDF</a>
        <a class="btn btn--ghost" href="{{ url_for('trips') }}">حجز رحلة أخرى</a>
      </div>

      <div class="card" style="padding:12px;margin-top:12px">
        <h3 style="margin:0 0 8px;">بيانات التواصل مع المرشد</h3>
        <ul style="margin:0;line-height:1.9">
          <li>واتساب: <a href="https://wa.me/966500000000" target="_blank" rel="noopener">+966500000000</a></li>
          <li>اتصال: <a href="tel:+966500000000">+966500000000</a></li>
        </ul>
      </div>
    </div>
  {% else %}
    {% if data %}
      <div class="card" style="padding:16px;margin-top:10px">
        <p>شكرًا <strong>{{ data.name }}</strong>، تم استلام طلبك بنجاح 👌</p>
        <ul style="line-height:1.9">
          <li>الرحلة: <strong>{{ data.trip.title }}</strong> — {{ data.trip.city }}</li>
          <li>عدد الأيام: <strong>{{ data.days }}</strong> | الأشخاص: <strong>{{ data.persons }}</strong></li>
          <li>السعر اليومي: <strong>{{ data.trip.price_per_day }}</strong> ر.س</li>
          <li>الإجمالي: <strong>{{ data.total_price }}</strong> ر.س</li>
          <li class="muted">وقت الإنشاء: {{ data.created_at }}</li>
        </ul>
        <div class="note" style="margin-top:10px">
          <strong>خطوة أخيرة:</strong> الرجاء إتمام الدفع لتأكيد الحجز نهائيًا.
        </div>
        <form action="{{ url_for('pay_start') }}" method="post" style="margin-top:12px">
          <button class="btn btn--primary" type="submit">إتمام الدفع</button>
          <a class="btn btn--ghost" href="{{ url_for('trips') }}">الرجوع للرحلات</a>
        </form>
      </div>
    {% else %}
      <p class="muted">لا يوجد حجز لعرضه.</p>
      <p><a class="btn btn--ghost" href="{{ url_for('booking') }}">العودة للحجز</a></p>
    {% endif %}
  {% endif %}
</section>
{% endblock %}