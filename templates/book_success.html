{% extends "base.html" %}
{% block title %}تم تأكيد الحجز — وجهة السعودية{% endblock %}

{% block content %}
<section class="container" style="padding:22px 0">
  <h1 class="page-title">تم تأكيد الحجز</h1>

  {% with msgs = get_flashed_messages(with_categories=true) %}
    {% if msgs %}
      <div class="flash">
        {% for cat, msg in msgs %}
          <p class="flash__msg {{cat}}">{{ msg }}</p>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  {% if details %}
    <div class="card" style="padding:16px;margin-top:10px">
      <ul style="line-height:1.9">
        <li>الرحلة: <strong>{{ details.trip_title or details.trip.title }}</strong></li>
        <li>المدينة: {{ details.trip.city if details.trip else '' }}</li>
        <li>الاسم: <strong>{{ details.name }}</strong></li>
        <li>البريد: {{ details.email }}</li>
        <li>الجوال: {{ details.phone }}</li>
        <li>التاريخ: {{ details.date }}</li>
        <li>عدد الأيام: {{ details.days }} | الأشخاص: {{ details.persons }}</li>
        <li class="muted">الإجمالي: {{ details.total_sar or details.total_price }} ر.س</li>
        <li class="muted">وقت الإنشاء: {{ details.created_at }}</li>
      </ul>

      {% if not paid %}
        <div class="note" style="margin-top:10px">
          <strong>خطوة أخيرة:</strong> الرجاء إتمام الدفع لتأكيد الحجز نهائيًا.
        </div>
        <form action="{{ url_for('pay_start') }}" method="post" style="margin-top:12px">
          <button class="btn btn--primary" type="submit">💳 إتمام الدفع</button>
          <a class="btn btn--ghost" href="{{ url_for('trips') }}">🔙 الرجوع للرحلات</a>
        </form>
      {% else %}
        <div class="note" style="margin-top:10px">
          ✅ تم الدفع بنجاح — شكرًا لاختيارك وجهة السعودية!
        </div>
        <div class="card__actions" style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;">
          <a class="btn btn--primary" href="{{ url_for('invoice_pdf') }}">📄 تحميل الفاتورة PDF</a>
          <a class="btn btn--ghost" href="{{ url_for('trips') }}">🌍 حجز رحلة أخرى</a>
        </div>

        <div class="card" style="padding:12px;margin-top:12px">
          <h3 style="margin:0 0 8px;">📞 بيانات التواصل مع المرشد</h3>
          <ul style="margin:0;line-height:1.9">
            <li>واتساب: <a href="https://wa.me/966500000000" target="_blank" rel="noopener">+966500000000</a></li>
            <li>اتصال: <a href="tel:+966500000000">+966500000000</a></li>
          </ul>
        </div>
      {% endif %}
    </div>
  {% else %}
    <p class="muted">لا يوجد حجز لعرضه.</p>
    <p><a class="btn btn--ghost" href="{{ url_for('booking') }}">العودة للحجز</a></p>
  {% endif %}
</section>
{% endblock %}