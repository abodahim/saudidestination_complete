{% extends "base.html" %}
{% block title %}تفاصيل الحجز #{{ b.id }}{% endblock %}
{% block content %}
<h1 class="page-title">تفاصيل الحجز #{{ b.id }}</h1>

<div class="card--panel" style="margin-bottom:14px">
  <p>رقم الفاتورة: <strong>{{ b.invoice_number or '—' }}</strong></p>
  <p>الحالة:
    {% if b.status == 'paid' %}
      <span style="color:#0f6a3e; font-weight:700">مدفوع</span>
      {% if b.paid_at %}<small class="muted"> • {{ b.paid_at.strftime('%Y-%m-%d %H:%M') }}</small>{% endif %}
    {% else %}
      <span class="muted">قيد الانتظار</span>
    {% endif %}
  </p>
  <p>الاسم: <strong>{{ b.name }}</strong> — البريد: <strong dir="ltr">{{ b.email }}</strong> — الجوال: <strong dir="ltr">{{ b.phone }}</strong></p>
</div>

<div class="card--panel">
  <h3>{{ trip.name }}</h3>
  <p class="muted">سعر اليوم: {{ trip.price }} ر.س — عدد الأيام: {{ b.days }}</p>
  <p>الإجمالي: <strong>{{ b.total }} ر.س</strong></p>

  <div class="card__actions" style="margin-top:10px">
    <a class="btn" href="{{ url_for('booking_invoice_html', booking_id=b.id) }}" target="_blank">عرض الفاتورة (HTML)</a>
    <a class="btn btn--primary" href="{{ url_for('booking_invoice_pdf', booking_id=b.id) }}" target="_blank">تحميل PDF</a>
  </div>
</div>

{% if b.status != 'paid' %}
<div class="card--panel" style="margin-top:14px">
  <h3>إتمام الدفع</h3>
  <p class="muted">عند إتمام الدفع ستظهر لك بيانات التواصل مباشرة.</p>
  <form method="post" action="{{ url_for('pay', booking_id=b.id) }}">
    <button class="btn btn--primary" type="submit">ادفع الآن</button>
  </form>
</div>
{% else %}
<div class="card--panel" style="margin-top:14px">
  <h3>بيانات التواصل</h3>
  <ul>
    {% if company.whatsapp %}
      <li>واتساب: <a dir="ltr" href="https://wa.me/{{ company.whatsapp }}" target="_blank">{{ company.whatsapp }}</a></li>
    {% endif %}
    {% if company.phone %}
      <li>اتصال: <a dir="ltr" href="tel:{{ company.phone }}">{{ company.phone }}</a></li>
    {% endif %}
    <li>البريد: <a dir="ltr" href="mailto:{{ company.email }}">{{ company.email }}</a></li>
  </ul>
</div>
{% endif %}
{% endblock %}
